<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Monthly Fatalities by Province</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        #chartWrapper {
            max-width: 900px;
            margin: auto;
        }
    </style>
</head>
<body>

<h2>Fatalities by Province (Jan 1997)</h2>

<div id="chartWrapper">
    <canvas id="fatalitiesBarChart"></canvas>
</div>

<script>
const API_URL = "http://localhost:8000/api/analytics/?year=1997&month=1";

async function loadData() {
    const response = await fetch(API_URL);
    return await response.json();
}

async function renderChart() {
    const data = await loadData();

    // Direct mapping (no aggregation)
    const labels = data.map(row => row.province);
    const values = data.map(row => row.fatalities);

    const ctx = document.getElementById("fatalitiesBarChart").getContext("2d");

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Fatalities",
                data: values
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: "Fatalities by Province (Jan 1997)"
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: "Fatalities"
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: "Province"
                    }
                }
            }
        }
    });
}

renderChart();
</script>

</body>
</html>
