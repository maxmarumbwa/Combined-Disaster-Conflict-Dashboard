<!DOCTYPE html>
<html>
<head>
    <title>Fatalities Choropleth</title>

    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        #map { height: 500px; }
    </style>
</head>
<body>

<h2>Fatalities Choropleth</h2>

<!-- Dropdown form -->
<form method="get">
    <label>Year:</label>
    <select name="year">
        <option value="">-- Select Year --</option>
        {% for y in years %}
            <option value="{{ y }}" {% if y|stringformat:"s" == selected_year %}selected{% endif %}>
                {{ y }}
            </option>
        {% endfor %}
    </select>

    <label>Month:</label>
    <select name="month">
        <option value="">-- Select Month --</option>
        {% for m in months %}
            <option value="{{ m }}" {% if m|stringformat:"s" == selected_month %}selected{% endif %}>
                {{ m }}
            </option>
        {% endfor %}
    </select>

    <!-- NEW: Indicator dropdown -->
    <label>Indicator:</label>
    <select name="indicator">
        {% for ind in indicators %}
            <option value="{{ ind }}" {% if ind == selected_indicator %}selected{% endif %}>
                {{ ind|capfirst }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Load Map</button>
</form>


<hr>

<div id="map"></div>

<script>
    const map = L.map("map").setView([-3.5, 23.5], 5);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap"
    }).addTo(map);

    const geojsonData = {{ geojson|safe }};

    if (geojsonData.features.length > 0) {
        L.geoJSON(geojsonData, {
    style: function(feature) {
        const val = feature.properties.value || 0;
        const fillColor = val > 50 ? "#800026" :
                          val > 20 ? "#BD0026" :
                          val > 5  ? "#E31A1C" :
                                     "#FFEDA0";
        return { fillColor, color: "#000", weight: 1, fillOpacity: 0.7 };
    }
}).addTo(map);

    }
</script>

</body>
</html>
